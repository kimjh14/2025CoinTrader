# V2_Based_with_CHATGPT ì½”ë“œ ì„¤ëª…

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
V2_Based_with_CHATGPT/
â”œâ”€â”€ tools/                      # í•µì‹¬ ë„êµ¬ ëª¨ìŒ
â”‚   â”œâ”€â”€ collect.py              # ì—…ë¹„íŠ¸ API ë°ì´í„° ìˆ˜ì§‘
â”‚   â”œâ”€â”€ build_dataset.py        # ê¸°ìˆ ì§€í‘œ ê³„ì‚° ë° ë°ì´í„°ì…‹ ìƒì„±
â”‚   â”œâ”€â”€ train.py                # ëª¨ë¸ í•™ìŠµ (HistGradientBoosting)
â”‚   â”œâ”€â”€ backtest.py             # ë°±í…ŒìŠ¤íŒ… ì—”ì§„
â”‚   â”œâ”€â”€ backtest_period.py      # ê¸°ê°„ë³„ ë°±í…ŒìŠ¤íŒ…
â”‚   â”œâ”€â”€ live_paper_v2.py        # ì‹¤ì‹œê°„ í˜ì´í¼ íŠ¸ë ˆì´ë”©
â”‚   â”œâ”€â”€ config.py               # ì „ì—­ ì„¤ì •
â”‚   â”œâ”€â”€ batch_data.py           # ì¼ê´„ ë°ì´í„°ì…‹ ìƒì„±
â”‚   â”œâ”€â”€ batch_train.py          # ì¼ê´„ ëª¨ë¸ í•™ìŠµ
â”‚   â”œâ”€â”€ batch_back.py           # ì¼ê´„ ë°±í…ŒìŠ¤íŒ…
â”‚   â””â”€â”€ one_click_pipeline.py   # ì›í´ë¦­ ì „ì²´ íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ ml/                         # ë¨¸ì‹ ëŸ¬ë‹ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ indicators.py           # ê¸°ìˆ ì§€í‘œ ê³„ì‚° í•¨ìˆ˜
â”‚   â””â”€â”€ pnl_utils.py           # ìˆ˜ìµë¥  ê³„ì‚° ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ data/                       # ë°ì´í„° ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ raw/                    # ì›ë³¸ OHLCV ë°ì´í„°
â”‚   â”œâ”€â”€ classic/                # CLASSIC ëª¨ë“œ ë°ì´í„°ì…‹
â”‚   â””â”€â”€ seq/                    # SEQ ëª¨ë“œ ë°ì´í„°ì…‹
â”œâ”€â”€ artifacts/                  # í•™ìŠµ ê²°ê³¼ë¬¼
â”‚   â”œâ”€â”€ train/                  # í•™ìŠµëœ ëª¨ë¸/ìŠ¤ì¼€ì¼ëŸ¬
â”‚   â”œâ”€â”€ backtest/               # ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼
â”‚   â””â”€â”€ live/                   # ì‹¤ì‹œê°„ ê±°ë˜ ìƒíƒœ
â”œâ”€â”€ analyze_backtest_results.py # ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¢…í•© ë¶„ì„
â”œâ”€â”€ analyze_best_trade.py       # ìµœê³  ìˆ˜ìµ ê±°ë˜ ìƒì„¸ ë¶„ì„
â””â”€â”€ analyze_model.py           # ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„

```

## ğŸ”§ í•µì‹¬ ë„êµ¬ ì„¤ëª…

### 1. **collect.py** - ë°ì´í„° ìˆ˜ì§‘
```python
# ì—…ë¹„íŠ¸ì—ì„œ 1ë¶„ë´‰ ë°ì´í„° ìˆ˜ì§‘
python tools/collect.py --market KRW-BTC --minutes 1 --days 10
```
- ì—…ë¹„íŠ¸ APIë¥¼ í†µí•´ ì‹¤ì‹œê°„/ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘
- 1ë¶„ë´‰ OHLCV ë°ì´í„°ë¥¼ parquet/csvë¡œ ì €ì¥
- 200ê°œì”© ë‚˜ëˆ„ì–´ API ì œí•œ íšŒí”¼

### 2. **build_dataset.py** - ë°ì´í„°ì…‹ ìƒì„±
```python
# CLASSIC ëª¨ë“œ (ê¸°ìˆ ì§€í‘œ ê¸°ë°˜)
python tools/build_dataset.py `
  --mode classic --in data/raw/krw_btc_1m_10d.parquet `
  --out data/classic/dataset.parquet `
  --horizon 2 --up 0.001 --dn -0.001 --tfs "3,5"

# SEQ ëª¨ë“œ (ì‹œí€€ìŠ¤ íŒ¨í„´)
python tools/build_dataset.py `
  --mode seq --in data/raw/krw_btc_1m_10d.parquet `
  --out data/seq/dataset.parquet `
  --n_steps 20 --horizon 2 --up 0.001 --dn -0.001
```

**ê¸°ìˆ ì§€í‘œ ê³„ì‚° (ì¢…ê°€ ê¸°ì¤€)**:
- **ì´ë™í‰ê· **: EMA(12,26), SMA(20,50) - ì¢…ê°€ ê¸°ì¤€
- **ë³¼ë¦°ì €ë°´ë“œ**: 20ì¼ SMA Â± 2Ïƒ - ì¢…ê°€ ê¸°ì¤€
- **MACD**: EMA(12) - EMA(26) - ì¢…ê°€ ê¸°ì¤€
- **RSI**: Wilder's RSI(14) - ì¢…ê°€ ë³€í™”ëŸ‰ ê¸°ì¤€
- **ATR**: Wilder's ATR(14) - ê³ /ì €/ì¢…ê°€ ê¸°ì¤€
- **ìˆ˜ìµë¥ /ë³€ë™ì„±**: 1,5,15,30,60ë¶„ - ì¢…ê°€ ê¸°ì¤€

**ë©€í‹° íƒ€ì„í”„ë ˆì„ (MTF)**:
- 3ë¶„ë´‰, 5ë¶„ë´‰ ì§€í‘œë¥¼ 1ë¶„ë´‰ì— ë³‘í•©
- ê° íƒ€ì„í”„ë ˆì„ë³„ MACD, RSI, ë³¼ë¦°ì €ë°´ë“œ ë“±

**ë¼ë²¨ë§**:
- UP: horizonë¶„ í›„ ìˆ˜ìµë¥  > threshold
- DOWN: horizonë¶„ í›„ ìˆ˜ìµë¥  < -threshold  
- FLAT: ê·¸ ì™¸

### 3. **train.py** - ëª¨ë¸ í•™ìŠµ
```python
python tools/train.py `
  --data data/classic/dataset.parquet `
  --model artifacts/train/model.joblib `
  --splits 4 --fee 0.0005 --allow_short
```

**í•™ìŠµ í”„ë¡œì„¸ìŠ¤**:
1. ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
2. ì‹œê³„ì—´ ë¶„í•  (TimeSeriesSplit)
3. HistGradientBoostingClassifier í•™ìŠµ
4. ìµœì  ì„ê³„ê°’ íƒìƒ‰ (Sharpe Ratio ìµœëŒ€í™”)
5. ëª¨ë¸/ìŠ¤ì¼€ì¼ëŸ¬/ë©”íƒ€ ì €ì¥

**ìµœì í™”**:
- Walk-forward ê²€ì¦
- ìˆ˜ìˆ˜ë£Œ ê³ ë ¤ ì„ê³„ê°’ ìµœì í™”
- í´ë˜ìŠ¤ ë¶ˆê· í˜• ì²˜ë¦¬

### 4. **backtest.py** - ë°±í…ŒìŠ¤íŒ…
```python
python tools/backtest.py `
  --data data/classic/dataset.parquet `
  --model artifacts/train/model.joblib `
  --fee 0.0005 --report artifacts/backtest/report.json
```

**ê±°ë˜ ë¡œì§**:
1. **ì‹ í˜¸ ë°œìƒ**: í˜„ì¬ ë´‰ì˜ í”¼ì²˜ë¡œ ì˜ˆì¸¡
2. **ê±°ë˜ ì‹¤í–‰**: ë‹¤ìŒ ë´‰ ì‹œê°€ì—ì„œ ì²´ê²°
3. **í¬ì§€ì…˜ ê´€ë¦¬**: LONG/SHORT/FLAT
4. **í”Œë¦½ ê¸°ëŠ¥**: ë°˜ëŒ€ í¬ì§€ì…˜ìœ¼ë¡œ ì¦‰ì‹œ ì „í™˜

**ì„±ê³¼ ì§€í‘œ**:
- ëˆ„ì  ìˆ˜ìµë¥ , ìƒ¤í”„ ë¹„ìœ¨
- ìµœëŒ€ ë‚™í­(MDD), ìŠ¹ë¥ 
- ê±°ë˜ íšŸìˆ˜, í‰ê·  ë³´ìœ ì‹œê°„

### 5. **live_paper_v2.py** - ì‹¤ì‹œê°„ í˜ì´í¼ íŠ¸ë ˆì´ë”©
```python
python tools/live_paper_v2.py `
  --market KRW-BTC `
  --model artifacts/train/model.joblib `
  --fee 0.0005 --state artifacts/live/state.json
```

**ì‹¤ì‹œê°„ ì²˜ë¦¬**:
1. ë§¤ë¶„ ìµœì‹  ë°ì´í„° ìˆ˜ì§‘ (1200ë¶„)
2. ì›Œë°ì—… ì ìš© (420ë¶„)
3. ê¸°ìˆ ì§€í‘œ ê³„ì‚° ë° ì˜ˆì¸¡
4. ê°€ìƒ ê±°ë˜ ì‹¤í–‰ ë° ìƒíƒœ ê´€ë¦¬

**ì§€í‘œ í‘œì‹œ (ê°œì„ ë¨)**:
- ì‹¤ì‹œê°„ OHLCV ë° ê±°ë˜ëŸ‰
- ë³¼ë¦°ì €ë°´ë“œ ê°€ê²© (ìƒë‹¨/ì¤‘ì‹¬/í•˜ë‹¨) - ì›í™” í‘œì‹œ
- ì´ë™í‰ê· ì„  (EMA12/26, SMA20/50) - ì›í™” í‘œì‹œ
- ë©€í‹° íƒ€ì„í”„ë ˆì„ ì§€í‘œ (3ë¶„/5ë¶„ë´‰)
- ìˆ˜ìµë¥ /ë³€ë™ì„± (í¼ì„¼íŠ¸ í‘œì‹œ)
- ì˜ˆì¸¡ í™•ë¥  ë° ê±°ë˜ ê²°ì •

### 6. **ë°°ì¹˜ ë„êµ¬ (batch_*.py)**

**batch_data.py** - ë‹¤ì¤‘ íŒŒë¼ë¯¸í„° ë°ì´í„°ì…‹ ìƒì„±
```python
python tools/batch_data.py --mode classic
# DAYS: [10, 181]
# HORIZON: [1,2,3,5,7,10]
# THRESHOLD: [0.0001~0.002]
# ì¶œë ¥: n20_h2_t0.001 ì²˜ë¦¬ ì¤‘... [OK]
```

**batch_train.py** - ì¼ê´„ ëª¨ë¸ í•™ìŠµ
```python
python tools/batch_train.py --mode classic --splits 4
# ì¶œë ¥: d10_h2_t0.001 ì²˜ë¦¬ ì¤‘... [OK]
```

**batch_back.py** - ì¼ê´„ ë°±í…ŒìŠ¤íŒ…
```python
python tools/batch_back.py --mode classic --fee 0.0005
# ì¶œë ¥: d10_h2_t0.001 ì²˜ë¦¬ ì¤‘... [OK]
```

### 7. **ë¶„ì„ ë„êµ¬**

**analyze_backtest_results.py**
- ëª¨ë“  ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¢…í•© ë¶„ì„
- TOP/BOTTOM 15 ì¡°í•© í‘œì‹œ
- Horizon/Thresholdë³„ í‰ê·  ìˆ˜ìµë¥ 
- ë‚ ì§œ í•„í„°ë§ ê¸°ëŠ¥ (DAYS_TO_ANALYZE ë³€ìˆ˜)

**analyze_best_trade.py** (ê°œì„ ë¨)
- ìµœê³  ìˆ˜ìµ ê±°ë˜ ìƒì„¸ ë¶„ì„
- ì§„ì…/ì²­ì‚° ì‹œì  ê¸°ìˆ ì§€í‘œ ìƒì„¸ í‘œì‹œ
  - ë³¼ë¦°ì €ë°´ë“œ ê°€ê²© (ì›í™”)
  - ì´ë™í‰ê· ì„  ê°€ê²© (ì›í™”)
  - ìˆ˜ìµë¥ /ë³€ë™ì„± (í¼ì„¼íŠ¸)
  - ë©€í‹° íƒ€ì„í”„ë ˆì„ ì§€í‘œ
- ì‹ í˜¸ ë°œìƒê³¼ ì‹¤í–‰ ì‹œì  ëª…í™•íˆ êµ¬ë¶„
- ë³´ìœ  ê¸°ê°„ ì¤‘ í™•ë¥  ë³€í™” ì¶”ì 

## ğŸ’¡ ì£¼ìš” íŠ¹ì§•

### ê±°ë˜ ì‹ í˜¸ì™€ ì‹¤í–‰ ë¶„ë¦¬
- **ì‹ í˜¸**: í˜„ì¬ ë´‰ ì¢…ë£Œ ì‹œì  (ì¢…ê°€ ê¸°ì¤€ ì§€í‘œ)
- **ì‹¤í–‰**: ë‹¤ìŒ ë´‰ ì‹œì‘ ì‹œì  (ì‹œê°€ ì²´ê²°)
- í˜„ì‹¤ì ì¸ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜

### ë©€í‹° íƒ€ì„í”„ë ˆì„ ë¶„ì„
- 1ë¶„ë´‰ + 3ë¶„ë´‰ + 5ë¶„ë´‰ ì§€í‘œ í†µí•©
- ë‹¤ì–‘í•œ ì‹œê°„ëŒ€ì˜ ì¶”ì„¸ í¬ì°©
- ë…¸ì´ì¦ˆ ê°ì†Œ ë° ì‹ í˜¸ ì‹ ë¢°ë„ í–¥ìƒ

### í”Œë¦½ ê±°ë˜ ì§€ì›
- LONG â†’ SHORT ì¦‰ì‹œ ì „í™˜
- SHORT â†’ LONG ì¦‰ì‹œ ì „í™˜
- ì‹œì¥ ë³€í™”ì— ë¹ ë¥¸ ëŒ€ì‘

### ìµœì í™”ëœ ì„ê³„ê°’
- ë°ì´í„°ë³„ ìµœì  threshold ìë™ íƒìƒ‰
- ìˆ˜ìˆ˜ë£Œ ê³ ë ¤í•œ ì‹¤ì§ˆ ìˆ˜ìµë¥  ìµœëŒ€í™”
- Walk-forward ê²€ì¦ìœ¼ë¡œ ê³¼ì í•© ë°©ì§€

## ğŸ“Š ê¸°ìˆ ì§€í‘œ ê³„ì‚° ê¸°ì¤€

ëª¨ë“  ì§€í‘œëŠ” **ì¢…ê°€(close)** ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤:

| ì§€í‘œ | ê³„ì‚° ë°©ì‹ | ê¸°ì¤€ | ì½”ë“œ |
|------|----------|------|------|
| EMA(12,26) | ì§€ìˆ˜ì´ë™í‰ê·  | ì¢…ê°€ | `ema(df["close"], 12)` |
| SMA(20,50) | ë‹¨ìˆœì´ë™í‰ê·  | ì¢…ê°€ | `df["close"].rolling(20).mean()` |
| ë³¼ë¦°ì €ë°´ë“œ | SMA(20) Â± 2Ïƒ | ì¢…ê°€ | `bollinger(df["close"], 20, 2.0)` |
| MACD | EMA(12) - EMA(26) | ì¢…ê°€ | `ema_12 - ema_26` |
| RSI(14) | Wilder's RSI | ì¢…ê°€ ë³€í™”ëŸ‰ | `rsi(df["close"], 14)` |
| ATR(14) | Wilder's ATR | ê³ /ì €/ì¢…ê°€ | `atr(high, low, close, 14)` |
| ìˆ˜ìµë¥  | (í˜„ì¬-ì´ì „)/ì´ì „ | ì¢…ê°€ | `df["close"].pct_change()` |
| ë³€ë™ì„± | ìˆ˜ìµë¥  í‘œì¤€í¸ì°¨ | ì¢…ê°€ | `returns.rolling(20).std()` |

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
```bash
python tools/one_click_pipeline.py --days 10 --splits 4
```

### 2. ê°œë³„ ë‹¨ê³„ ì‹¤í–‰
```bash
# ë°ì´í„° ìˆ˜ì§‘
python tools/collect.py --market KRW-BTC --days 10

# ë°ì´í„°ì…‹ ìƒì„±
python tools/build_dataset.py --mode classic --horizon 2

# ëª¨ë¸ í•™ìŠµ
python tools/train.py --data data/classic/dataset.parquet

# ë°±í…ŒìŠ¤íŒ…
python tools/backtest.py --model artifacts/train/model.joblib

# ì‹¤ì‹œê°„ ê±°ë˜
python tools/live_paper_v2.py --model artifacts/train/model.joblib
```

### 3. ë¶„ì„
```bash
# ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
python analyze_backtest_results.py

# ìµœê³  ê±°ë˜ ë¶„ì„
python analyze_best_trade.py --trades artifacts/backtest/trades.csv
```

## ğŸ“ ì„¤ì • íŒŒì¼

**config.py** - ì „ì—­ ì„¤ì •
- TARGET_COINS: ê±°ë˜ ëŒ€ìƒ (KRW-BTC)
- íŒŒì¼ ê²½ë¡œ ë° ë””ë ‰í† ë¦¬ êµ¬ì¡°
- ê¸°ë³¸ íŒŒë¼ë¯¸í„° ê°’

**ë°°ì¹˜ ë„êµ¬ ì„¤ì • ë³€ìˆ˜**
- `batch_data.py`: DAYS_TO_PROCESS, HORIZON_CANDIDATES, THRESHOLD_CANDIDATES
- `batch_train.py`: ìë™ìœ¼ë¡œ batch_data ì„¤ì • ë”°ë¦„
- `batch_back.py`: ìë™ìœ¼ë¡œ batch_data ì„¤ì • ë”°ë¦„
- `analyze_backtest_results.py`: DAYS_TO_ANALYZE (ë‚ ì§œ í•„í„°)

## ğŸ”„ ì—…ë°ì´íŠ¸ ê¸°ë¡

### 2025.08.18 ìµœì‹  ì—…ë°ì´íŠ¸
- **ì½”ë“œ ë¬¸ì„œ ìë™ ì—…ë°ì´íŠ¸ ê·œì¹™ ì¶”ê°€**: ì½”ë“œ ìˆ˜ì • ì‹œ ê´€ë ¨ ë¬¸ì„œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
- **ê°œì„ ëœ ì¶œë ¥ í˜•ì‹**:
  - `live_paper_v2.py`: ë³¼ë¦°ì €ë°´ë“œ/ì´ë™í‰ê·  ì›í™” í‘œì‹œ, í¼ì„¼íŠ¸ ë³€í™˜
  - `analyze_best_trade.py`: ì§„ì…/ì²­ì‚° ìƒì„¸ ì§€í‘œ, ì¤‘ë³µ ì œê±°
  - `batch_*.py`: íŒŒë¼ë¯¸í„° ì •ë³´ í¬í•¨í•œ ì§„í–‰ ìƒí™© í‘œì‹œ
- **ë‚ ì§œ í•„í„°ë§**: `analyze_backtest_results.py`ì— DAYS_TO_ANALYZE ë³€ìˆ˜ ì¶”ê°€
- **í”Œë¦½ ê±°ë˜**: ëª¨ë“  ë„êµ¬ì—ì„œ í¬ì§€ì…˜ ì¦‰ì‹œ ì „í™˜ ì§€ì›

### 2025.08.17
- í”Œë¦½ ê±°ë˜ ê¸°ëŠ¥ êµ¬í˜„
- ë©€í‹° íƒ€ì„í”„ë ˆì„ ì§€í‘œ í†µí•©
- ë°°ì¹˜ ì²˜ë¦¬ ë„êµ¬ ì™„ì„±

## âš™ï¸ ìµœì í™” ê¸°ë²•

### 1. ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- Parquet í˜•ì‹ ì‚¬ìš© (ì••ì¶•ë¥  ë†’ìŒ)
- ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬
- ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ ì œê±°

### 2. ì²˜ë¦¬ ì†ë„
- ë²¡í„°í™” ì—°ì‚° í™œìš©
- NumPy ë°°ì—´ ìµœì í™”
- ë³‘ë ¬ ì²˜ë¦¬ ì§€ì›

### 3. ì•ˆì •ì„±
- ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
- ë°ì´í„° ê²€ì¦

## ğŸ› ï¸ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œ
1. **API ì œí•œ**: Rate limit ë„ë‹¬ ì‹œ ìë™ ëŒ€ê¸°
2. **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**: ìë™ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
3. **ë°ì´í„° ëˆ„ë½**: ê²°ì •ë¡ ì  ìŠ¤í…Œí•‘ìœ¼ë¡œ ë°©ì§€

### ë””ë²„ê¹… ëª…ë ¹ì–´
```powershell
# ìˆ˜ì§‘ ë¡œê·¸
python tools/collect.py --verbose

# í•™ìŠµ ë¡œê·¸
python tools/train.py --debug

# ë°±í…ŒìŠ¤íŒ… ë¡œê·¸
python tools/backtest.py --verbose
```

---
*ìµœì¢… ì—…ë°ì´íŠ¸: 2025.08.18*